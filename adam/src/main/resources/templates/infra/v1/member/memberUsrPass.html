<!DOCTYPE html>
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if IE 9 ]><html class="ie ie9" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--<![endif]-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<!-- head -->
<div th:replace="~{infra/v1/include/headUsr :: head}"></div>

<body class="user-register blog">
    <header>
        <!-- header desktop -->
        <div class="header-top d-xs-none ">
            <div class="container">
            	<div th:replace="~{infra/v1/include/bodyUsr :: topMenu(2)}"></div>
            </div>
        </div>
    </header>

    <!-- main content -->
    <div class="main-content">
        <div class="wrap-banner">
            <!-- breadcrumb -->
            <nav class="breadcrumb-bg">
                <div class="container no-index">
                    <div class="breadcrumb">
                        <ol>
                            <li><a href="/indexUsr"><span>Home</span></a></li>
                            <li><span><b>비밀번호 변경</b></span></li>
                        </ol>
                    </div>
                </div>
            </nav>
        </div>

        <!-- main -->
        <div id="wrapper-site">
            <div class="container">
                <div class="row">
                    <div id="content-wrapper" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 onecol">
                        <div id="main">
                            <div id="content" class="page-content">
                            	<div class="register-form text-center">
                                    <h1 class="text-center title-page">비밀번호 변경</h1>
                                	<form name="form" id="form" class="js-customer-form" method="post" autocomplete="off">
	                                    <div>   
	                                        <!-- 비밀번호 -->
	                                        <div class="form-group mb-4">
	                                            <div>
	                                                <div class="input-group js-parent-focus">
	                                                    <input class="form-control js-child-focus js-visible-password"
	                                                    	id="xmbrPasswordPre" name="xmbrPasswordPre" type="password" placeholder="현재 비밀번호"
	                                                    	onkeyup="fnOnKeyUp(this)">
	                                                </div>
	                                            </div>
	                                            <span id="xmbrPasswordPreValid" name="xmbrPasswordPreValid" style="float: left; color: red; visibility:hidden;"></span>                                                
	                                        </div>                                            
	                                        <div class="form-group mb-4">
	                                            <div>
	                                                <div class="input-group js-parent-focus">
	                                                    <input class="form-control js-child-focus js-visible-password"
	                                                    	id="mbrPassword" name="mbrPassword" type="password" placeholder="새 비밀번호"
	                                                    	onkeyup="fnOnKeyUp(this)">
	                                                </div>
	                                            </div>
	                                            <span id="mbrPasswordValid" name="mbrPasswordValid" style="float: left; color: red; visibility:hidden;"></span>                                                
	                                        </div>
	
	                                        <div class="form-group">
	                                            <div>
	                                                <div class="input-group js-parent-focus">
	                                                    <input class="form-control js-child-focus js-visible-password"
	                                                    	id="xmbrPwConfirm" name="xmbrPwConfirm" type="password" placeholder="새 비밀번호 확인"
	                                                    	onkeyup="fnOnKeyUp(this)">
	                                                </div>
	                                            </div>
	                                            <span id="xmbrPwConfirmValid" name="xmbrPwConfirmValid" style="float: left; color: red; visibility:hidden;"></span>                                                
	                                        </div>
	                                    </div>
	                                    
	                                    <div class="clearfix">
	                                        <div>
	                                            <button class="form-control-submit btn btn-primary" id="btnSubmit" name="btnSubmit" type="button" style="font-size: 15px;">
	                                                확&nbsp;&nbsp;&nbsp;&nbsp;인
	                                            </button>
	                                        </div>
	                                    </div>                                    
                                	</form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- footer -->
    <div th:replace="~{infra/v1/include/headUsr :: footer}"></div>

    <!-- back top top -->
    <div class="back-to-top">
        <a href="#">
            <i class="fa fa-long-arrow-up"></i>
        </a>
    </div>
    
    <!-- modalFormOneBtn(타이틀, 내용, 버튼명) -->
    <div th:replace="~{infra/v1/include/modalSdm :: modalFormOneBtn('확인', '', '확인')}"></div>    

    <!-- Vendor JS -->
    <script src="usr/libs/jquery/jquery.min.js"></script>
    <script src="usr/libs/popper/popper.min.js"></script>
    <script src="usr/libs/bootstrap/js/bootstrap.min.js"></script>
    <script src="usr/libs/nivo-slider/js/jquery.nivo.slider.js"></script>
    <script src="usr/libs/owl-carousel/owl.carousel.min.js"></script>
    <script src="usr/libs/slider-range/js/tmpl.js"></script>
    <script src="usr/libs/slider-range/js/jquery.dependClass-0.1.js"></script>
    <script src="usr/libs/slider-range/js/draggable-0.1.js"></script>
    <script src="usr/libs/slider-range/js/jquery.slider.js"></script>
    <script src="usr/libs/slick-slider/js/slick.min.js"></script>

    <!-- Template JS -->
    <script src="usr/js/theme.js"></script>
    
    <script type="text/javascript">
// ============================================================================
// 변수선언
// ============================================================================
		let form = document.querySelector("form[name=form]");
		
		let goUrlUsrList   	= "/memberUsrList";		/* 조회화면 */
		let goUrlUsrForm   	= "/memberUsrPass";		/* 수정화면 */
		let goUrlUsrCreate 	= "/memberUsrCreate";	/* 등록화면 */
		let goUrlUsrInsert 	= "/memberUsrInsert";	/* 등록 */
		let goUrlUsrUpdate 	= "/memberUsrUpdate";	/* 수정 */
		let goUrlUsrDelete 	= "/memberUsrDelete";	/* 삭제 */

		let xmbrPasswordPre 		= document.querySelector("inupt[name=xmbrPasswordPre]");
		let xmbrPasswordPreValid 	= document.querySelector("span[name=xmbrPasswordPreValid]");
		
		let mbrPassword 			= document.querySelector("inupt[name=mbrPassword]");
		let mbrPasswordValid 		= document.querySelector("span[name=mbrPasswordValid]");
		
		let xmbrPwConfirm 			= document.querySelector("inupt[name=xmbrPwConfirm]");
		let xmbrPwConfirmValid 		= document.querySelector("span[name=xmbrPwConfirmValid]");
		
		// 필수입력체크대상
		// validType : 1(한글), 2(영문), 3(숫자:정수), 4(숫자:실수)
		//             10(한글영문), 11(한글숫자), 12(영문숫자), 13(한글영문숫자)
		//			   20(비밀번호), 21(날짜), 22(이메일)
		//             30(특수문자), 31(공백체크)
		// TYPE_KR   =  1, TYPE_EN   = 2,  TYPE_IT   = 3,  TYPE_FT     = 4;
		// TYPE_KREN = 10, TYPE_KRIT = 11, TYPE_ENIT = 12, TYPE_KRENIT = 13;
		// TYPE_PW   = 20, TYPE_DT   = 21, TYPE_EM   = 22;
		// TYPE_SP   = 30, TYPE_NULL = 31;
		let dispText = "5자리:영문,숫자,특수문자(!@#$%^*+=-)";
		let typeArr = [TYPE_PW, TYPE_PW, TYPE_PW];		
		let nameArr = ["xmbrPasswordPre", "mbrPassword", "xmbrPwConfirm"];
		let textArr = [dispText, dispText, dispText];	

// ============================================================================
// event
// ============================================================================

    	// 저장버튼
		document.getElementById("btnSubmit").onclick = function() {
			fnCallController();
		};
		
		// event onkeydown
		fnOnKeyDown = function() {
			// 엔터키(13)이면
			if (window.event.keyCode == 13) {
				if(!fnValidation()) return false;
				fnCallController();
			};				
		};
		
		// event onkeyup
		// fnValidType(obj:input tag객체, objValid:메시지표시 tag명, validText:objValid tag에 표시할 메시지, validType:정규식종류)
		fnOnKeyUp = function(obj) {
			if(window.event.keyCode != 13) {
				switch(obj.name) {
				case "xmbrPasswordPre" :
					fnValidType(obj, xmbrPasswordPreValid, dispText, TYPE_PW);
					break;					
				case "mbrPassword" :
					fnValidType(obj, mbrPasswordValid, dispText, TYPE_PW);
					break;					
				case "xmbrPwConfirm" :
					fnValidType(obj, xmbrPwConfirmValid, dispText, TYPE_PW);
					break;
				};
			};	
		};		

// ============================================================================
// function
// ============================================================================
		
		// controller 호출
		fnCallController = function() {
			if(!fnValidation()) {return false;}
			
			// 저장
			$.ajax({
				async: true
				, cache: false
				, type: "post"
				, data: {"xmbrPasswordPre":$("#xmbrPasswordPre").val(), "mbrPassword":$("#mbrPassword").val(), "xmbrPwConfirm":$("#xmbrPwConfirm").val()}
				, url: "/memberSdmUpdatePass"
				, success: function(response) {
					if(response.rt == "success") {
						location.href = "/indexUsr";
					} else if(response.rt == "newAndnew") {
						fnModalFormOneBtnShow("확인", "[새 비밀번호], [새 비밀번호 확인] 불일지");
					} else if(response.rt == "oldAndDb") {
						fnModalFormOneBtnShow("확인", "[현재 비밀번호] 불일지");			
					};
				}
				, error : function(jqXHR, textStatus, errorThrown){
					alert("ajaxUpdate " + jqXHR.textStatus + " : " + jqXHR.errorThrown);
					fnModalFormOneBtnShow("오류", "ajaxUpdate " + jqXHR.textStatus + " : " + jqXHR.errorThrown);	
				}
			});
		};	
		
		// 필수입력 확인
	    fnValidationForm = function() {
			let validChk = false;		
			return validChk;
		};

    </script>    
</body>

</html>